process TIFDQMSOURCES = {
#keep the logging output to a nice level
include "FWCore/MessageLogger/data/MessageLogger.cfi"

service = AdaptorConfig {}
#include 
#        source = PoolSource { 
#          	untracked vstring fileNames = {
#"rfio:/castor/cern.ch/cms/store/data/GlobalSep07/C/000/020/958/RAW/0000/0A87C330-D96D-DC11-8232-001617C3B6D2.root"
#}
#         }

      source = EventStreamHttpReader{
        string sourceURL = "http://cmsmon:50082/urn:xdaq-application:lid=29"
#        string sourceURL = "http://lhc01n02.fnal.gov:50082/urn:xdaq-application:lid=29"
        int32 max_event_size = 7000000
        int32 max_queue_depth = 5
        untracked string consumerName = "Sistrip DQM Source"
        untracked string consumerPriority = "normal"
        untracked int32 headerRetryInterval = 3
        untracked double maxEventRequestRate = 2.5
        untracked PSet SelectEvents = { vstring SelectEvents={"*"} }
      }

  untracked PSet maxEvents = {untracked int32 input = -1}
  # magnetic field
#  include "Geometry/CMSCommonData/data/cmsMagneticFieldXML.cfi"
  include "MagneticField/Engine/data/uniformMagneticField.cfi"
  replace UniformMagneticFieldESProducer.ZFieldInTesla = 0.0
  es_prefer = UniformMagneticFieldESProducer{}

  # tracker geometry
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
 
  # tracker numbering
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
 
  # cms geometry
  include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"

  # SiStripRaw2digi  
   include "EventFilter/SiStripRawToDigi/data/SiStripDigis.cfi" 

  # ZeroSuppressor
   include "RecoLocalTracker/SiStripZeroSuppression/data/SiStripZeroSuppression.cfi"


############# DQM
  # DQM services
  service = DaqMonitorROOTBackEnd{}

  ################# RawData Monitor ##################
   module RawDataMon = SiStripMonitorRawData {
    string DigiProducer="SiStripDigis"
    string OutputFileName="SiStripRawData.root"
    bool OutputMEsInRootFile = false
   }
  ################# SiStripMonitorDigi ################
  include "DQM/SiStripMonitorDigi/data/SiStripMonitorDigi_RealData.cfi"
  # use the following flag to select all detectors (e.g. for mtcc data). by default is false
  replace SiStripMonitorDigi.SelectAllDetectors = true

  ################ SiStripMonitorCluster ################
##  include "DQM/SiStripMonitorCluster/data/SiStripMonitorCluster.cfi"
##  # use the following flag to select all detectors (e.g. for mtcc data). by default is false
##  replace SiStripMonitorCluster.FillSignalNoiseHistos = false
##  replace SiStripMonitorCluster.OutputMEsInRootFile = true
##  replace SiStripMonitorCluster.UseCalibDataFromDB = true # this is for the noise service
##  replace SiStripMonitorCluster.SelectAllDetectors = true
 

  ################ The Client (SiStripMonitorAnalyser) ################
   module sistripAnalyser = SiStripAnalyser {
     untracked int32  CollationtionFlag = 0
     untracked int32  FileSaveFrequency = 1
     untracked int32  StaticUpdateFrequency = 1
      untracked bool  enableMonitorDaemon = false
     untracked string outputFile = "SiStrip.root"
   }
  ################ In case there is a down stream collector needed ##########
  include "DQM/SiStripMonitorCluster/data/MonitorDaemon.cfi"
  replace MonitorDaemon.DestinationAddress = "srv-c2d05-19"
  replace MonitorDaemon.UpdateDelay = 5000

  ################ Quality Tester ################   
##    module qTester = QualityTester {
##        untracked string qtList = "sistrip_qualitytest_config.xml"
##	untracked bool getQualityTestsFromFile = true	        
##        untracked int32 QualityTestPrescaler = 200
##    }

   service = ModuleWebRegistry { }


  ############ Access to ORCOFF via Frontier ############
  es_source = PoolDBESSource {
    VPSet toGet = {
      { string record = "SiStripFedCablingRcd" string tag = "SiStripCabling_TIF_DQM_v1"},
      { string record = "SiStripNoisesRcd" string tag = "SiStripPedNoise_TIF_v1_n"},
      { string record = "SiStripPedestalsRcd" string tag= "SiStripPedNoise_TIF_v1_p"}}
    bool loadAll = true
    string connect = "oracle://orcon/CMS_COND_STRIP"
    untracked string catalog = "relationalcatalog_oracle://orcon/CMS_COND_GENERAL"
    string timetype = "runnumber"
    PSet DBParameters = {
      #---if there is afs access uncomment next line 
      # untracked string authenticationPath ="/afs/cern.ch/cms/DB/conddb"
      #---if authentication.xml exists in the working area (online machines )
       untracked string authenticationPath ="."
       untracked int32 messageLevel = 1
       untracked bool loadBlobStreamer = true
    }
  }
  es_module sistripconn = SiStripConnectivity {}

######################## Scheduling
  path p = {SiStripDigis,siStripZeroSuppression,RawDataMon,SiStripMonitorDigi,sistripAnalyser}

}
 
